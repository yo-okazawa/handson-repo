topology "<%= node['chef-server']['topology'] %>"

server "<%= node['chef-server']['db1']['fqdn'] %>",
  :ipaddress => "<%= node['chef-server']['db1']['ipaddr'] %>",
  :role => "backend",
  :bootstrap => true

server "<%= node['chef-server']['db2']['fqdn'] %>",
  :ipaddress => "<%= node['chef-server']['db2']['ipaddr'] %>",
  :role => "backend"

backend_vip "<%= node['chef-server']['db_vip']['fqdn'] %>",
  :ipaddress => "<%= node['chef-server']['db_vip']['ipaddr'] %>",
  :device => "<%= node['chef-server']['db_vip']['device'] %>"

server "<%= node['chef-server']['ap1']['fqdn'] %>",
  :ipaddress => "<%= node['chef-server']['ap1']['ipaddr'] %>",
  :role => "frontend"

server "<%= node['chef-server']['ap2']['fqdn'] %>",
  :ipaddress => "<%= node['chef-server']['ap2']['ipaddr'] %>",
  :role => "frontend"

api_fqdn "<%= node['chef-server']['api']['fqdn'] %>"

oc_id['applications'] = {
  'analytics' => {
    'redirect_uri' => "https://<%= node['chef-server']['anltcs']['fqdn'] %>/"
  }
}

rabbitmq['vip'] = "<%= node['chef-server']['db_vip']['ipaddr'] %>"
rabbitmq['node_ip_address'] = '0.0.0.0'

case PrivateChef["servers"][node['fqdn']]["role"]
when "frontend"
  nginx['ssl_certificate']  = "/var/opt/opscode/nginx/ca/chefserver.cloud-platform.kddi.ne.jp.crt"
  nginx['ssl_certificate_key']  = "/var/opt/opscode/nginx/ca/chefserver.cloud-platform.kddi.ne.jp.key"
end
